<VirtualHost *:80>
ServerName qualishealth.zeomega.com
Redirect / https://qualishealth.zeomega.com/
</VirtualHost>

<VirtualHost 0.0.0.0:443>
ServerName qualishealth.zeomega.com

SSLEngine on

SSLProtocol -ALL +SSLv3 +TLSv1
SSLCipherSuite ALL:!aNULL:!ADH:!eNULL:!LOW:!EXP:RC4+RSA:+HIGH:+MEDIUM
SSLCertificateChainFile conf/ca.crt
SSLCertificateFile conf/jiva.crt
SSLCertificateKeyFile conf/jiva.key

ProxyPass /balancer-manager !
<Location /balancer-manager>
    SetHandler balancer-manager
    Order Deny,Allow
    Require valid-user
    AuthType Basic
    AuthName "Sysadmins Are Authenticated To Access"
    AuthUserFile conf/htpasswd
	Deny from all
    Allow from all 
</Location>

# CERME integration
ProxyPass /rm http://quasunprdcer01:8010/rm
ProxyPassReverse /rm http://qualishealth.zeomega.com/rm

# Cerme Historical Help button
ProxyPassMatch ^/help(\d{4}.*)$ http://10.0.7.4:8010/help$1
ProxyPassReverse /help http://qualisuat.zeomega.com/help

# CERME Help button
ProxyPass /help http://quasunprdcer01:8010/help
ProxyPassReverse /help http://qualishealth.zeomega.com/help

# Now set up the Balancer list of nodes.
Header add Set-Cookie "ROUTEID=.%{BALANCER_WORKER_ROUTE}e; path=/" env=BALANCER_ROUTE_CHANGED
<Proxy balancer://qualishealth_balancerSSL>
BalancerMember http://10.0.1.9:8300/  route=1
BalancerMember http://10.0.1.9:8301/  route=2
BalancerMember http://10.0.1.9:8302/  route=3
BalancerMember http://10.0.1.9:8303/  route=4
#BalancerMember http://10.0.1.9:8304/  route=5
BalancerMember http://10.0.1.11:8300/ route=6
BalancerMember http://10.0.1.11:8301/ route=7
BalancerMember http://10.0.1.11:8302/ route=8
BalancerMember http://10.0.1.11:8303/ route=9
#BalancerMember http://10.0.1.11:8304/ route=10

ProxySet stickysession=ROUTEID
</Proxy>

# Second Proxy Balancer: Used for customer who have tasks that take extra time
# to complete.
<Proxy balancer://qualishealth_cluster2_SSL>
BalancerMember http://10.0.1.9:8304/ route=5
BalancerMember http://10.0.1.11:8304/ route=10
ProxySet stickysession=ROUTEID
</Proxy>

# Long running tasks - new format
ProxyPassMatch ^/(.*/printNotification)$ balancer://qualishealth_cluster2_SSL/VirtualHostBase/https/qualishealth.zeomega.com:443/VirtualHostRoot/$1 lbmethod=byrequests
ProxyPassMatch ^/(.*/attachFaxes)$ balancer://qualishealth_cluster2_SSL/VirtualHostBase/https/qualishealth.zeomega.com:443/VirtualHostRoot/$1 lbmethod=byrequests
ProxyPassMatch ^/(.*/createPdfDocument)$ balancer://qualishealth_cluster2_SSL/VirtualHostBase/https/qualishealth.zeomega.com:443/VirtualHostRoot/$1 lbmethod=byrequests
ProxyPassMatch ^/(.*/getDocument)$ balancer://qualishealth_cluster2_SSL/VirtualHostBase/https/qualishealth.zeomega.com:443/VirtualHostRoot/$1 lbmethod=byrequests
ProxyPassMatch ^/(.*/addNewDocument)$ balancer://qualishealth_cluster2_SSL/VirtualHostBase/https/qualishealth.zeomega.com:443/VirtualHostRoot/$1 lbmethod=byrequests
ProxyPassMatch ^/(.*/createPdfDocument)$ balancer://qualishealth_cluster2_SSL/VirtualHostBase/https/qualishealth.zeomega.com:443/VirtualHostRoot/$1 lbmethod=byrequests


# Browser compatibility response
BrowserMatch ".*MSIE.*" nokeepalive ssl-unclean-shutdown downgrade-1.0 force-response-1.0

# Default Proxy rule - Should always be last
ProxyPass / balancer://qualishealth_balancerSSL/VirtualHostBase/https/qualishealth.zeomega.com:443/cms/ZeUI/VirtualHostRoot/ lbmethod=byrequests
ProxyPassReverse / https://qualishealth.zeomega.com
</VirtualHost>
